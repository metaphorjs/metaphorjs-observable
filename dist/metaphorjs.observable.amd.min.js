define("metaphorjs-observable",function(){function u(e){if(e&&void 0!=!e.length&&e!==""+e){for(var c=[],a=-1,b=e.length>>>0;++a!==b;c[a]=e[a]);return c}return e?[e]:[]}function v(e){return"object"==typeof e&&3===y(e)&&!e.nodeType&&e.constructor===Object}function w(e){return!0===e||!1===e}function q(){var e=!1,c=!1,a=u(arguments),b=a.shift(),f,d,r;w(a[a.length-1])&&(e=a.pop());w(a[a.length-1])&&(c=e,e=a.pop());for(;a.length;)if(f=a.shift())for(d in f)if(f.hasOwnProperty(d)&&void 0!==(r=f[d]))if(c)if(b[d]&&
v(b[d])&&v(r))q(b[d],r,e,c);else{if(!0===e||void 0==b[d])v(r)?(b[d]={},q(b[d],r,e,!0)):b[d]=r}else if(!0===e||void 0==b[d])b[d]=r;return b}function z(e,c,a,b){return setTimeout(function(){e.apply(c,a||[])},b||0)}var A=Object.prototype.toString,y=function(){var e={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(c){if(!c){if(null===c)return 6;if(void 0===c)return 7}var a=
e[A.call(c)];return void 0===a?-1:1===a&&isNaN(c)?8:a}}(),t={},B=function(){var e=["0","0","0"];return function(){for(var c=e.length,a;c;){c--;a=e[c].charCodeAt(0);if(57==a)return e[c]="A",e.join("");if(90==a)e[c]="0";else return e[c]=String.fromCharCode(a+1),e.join("")}e.unshift("0");return e.join("")}}(),C=function(){var e=[],c=function(a){var b;var c=0;for(b=e.length;c<b;c++)e[c][0].call(e[c][1],a);"undefined"!=typeof console&&console.error&&console.error(a)};c.on=function(a,b){c.un(a,b);e.push([a,
b])};c.un=function(a,b){var c;var d=0;for(c=e.length;d<c;d++)if(e[d][0]===a&&e[d][1]===b){e.splice(d,1);break}};return c}(),x=t.ObservableEvent=function(){var e=function(c,a){this.name=c;this.listeners=[];this.map={};this.hash=B();this.uni="$$"+c+"_"+this.hash;this.suspended=!1;this.fid=this.lid=0;"object"===typeof a&&null!==a?q(this,a,!0,!1):this.returnResult=a;this.triggered=0};q(e.prototype,{name:null,listeners:null,map:null,hash:null,uni:null,suspended:!1,lid:null,fid:null,limit:0,triggered:0,
returnResult:null,autoTrigger:null,lastTrigger:null,triggerFilter:null,filterContext:null,expectPromises:!1,resolvePromises:!1,getName:function(){return this.name},$destroy:function(){for(var c in this)this[c]=null},on:function(c,a,b){if(!c)return null;a=a||null;b=b||{};var f=this.uni,d=++this.lid,e=c[f]||++this.fid,m=f+"_"+e,l=b.first||!1;if(c[f]&&(!a||a[m])&&!b.allowDupes)return null;c[f]||(c[f]=e);a&&!a[m]&&(a[m]=!0);c={fn:c,context:a,id:d,fid:e,async:!1,called:0,limit:0,start:1,count:0,append:null,
prepend:null,replaceArgs:null};q(c,b,!0,!1);!0===c.async&&(c.async=1);b.once&&(c.limit=1);l?this.listeners.unshift(c):this.listeners.push(c);this.map[d]=c;if(this.autoTrigger&&this.lastTrigger&&!this.suspended){var k=this.triggerFilter;this.triggerFilter=function(a){return a.id===d?k?!1!==k(a):!0:!1};this.trigger.apply(this,this.lastTrigger);this.triggerFilter=k}return d},once:function(c,a,b){b=b||{};b.limit=1;return this.on(c,a,b)},un:function(c,a){var b=-1,f=this.uni,d=this.listeners;if(c==parseInt(c)){var e=
parseInt(c);if(!this.map[e])return!1;var m=this.map[e].fid}else m=c[f];if(!m)return!1;var l=f+"_"+m;a=a||null;for(var k=0,p=d.length;k<p;k++)if(d[k].fid===m&&d[k].context===a){b=k;e=d[k].id;delete c[f];a&&delete a[l];break}if(-1===b)return!1;d.splice(b,1);delete this.map[e];return!0},hasListener:function(c,a){var b=this.listeners;if(c){c="function"!=typeof c?parseInt(c):c[this.uni];if(!c)return!1;for(var f=this.uni+"_"+c,d=0,e=b.length;d<e;d++)if(b[d].fid===c&&(!a||a[f]))return!0;return!1}return 0<
b.length},removeAllListeners:function(){var c=this.listeners,a=this.uni,b;var f=0;for(b=c.length;f<b;f++){var d=a+"_"+c[f].fn[a];delete c[f].fn[a];c[f].context&&delete c[f].context[d]}this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(c,a){if(c.append||c.prepend){var b=c.prepend;var f=c.append;var d=a.slice();b&&("function"===typeof b&&(b=b(c,a)),d=b.concat(d));f&&("function"===typeof f&&(f=f(c,a)),d=d.concat(f))}else c.replaceArgs?
(d=c.replaceArgs,"function"===typeof d&&(d=d(c,a)),d=[].concat(d)):d=a;return d},trigger:function(){var c=this,a=c.listeners,b=c.returnResult,f=c.triggerFilter,d=c.filterContext,e=c.expectPromises,m=c.keepPromiseOrder,l=[],k=u(arguments),p;if(c.suspended||0<c.limit&&c.triggered>=c.limit)return null;c.triggered++;c.autoTrigger&&(c.lastTrigger=k.slice());if(0===a.length)return"pipe"===b?k[0]:null;var n="all"===b||"concat"===b?[]:"merge"===b?{}:null,g;var t="first"===b?[a[0]]:a.slice();for(e&&"last"===
b&&(m=!0);g=t.shift();)if(!(!g||!c.map[g.id]||(a=c._prepareArgs(g,k),f&&!1===f.call(d,g,a,c))||g.filter&&!1===g.filter.apply(g.filterContext||g.context,a)||(g.count++,g.count<g.start))){if(g.async&&!e){var h=null;z(g.fn,g.context,a,g.async)}else e?(h=function(a,b,d){return function(e){"pipe"===b&&(d[0]=e,d=c._prepareArgs(a,d));return a.fn.apply(a.context,d)}}(g,b,k.slice()),h=p?p.then(h):g.fn.apply(g.context,a),h.catch(C)):h=g.fn.apply(g.context,a);g.called++;g.called===g.limit&&c.un(g.id);if("first"===
b)return h;if(e)l.push(h),("pipe"===b||m)&&h&&(p=h);else if(null!==b)if("all"===b)n.push(h);else if("concat"===b&&h)n=n.concat(h);else if("merge"===b)q(n,h,!0,!1);else{if("nonempty"===b&&h)return h;if("pipe"===b)n=h,k[0]=h;else if("last"===b)n=h;else{if(!1===b&&!1===h)return!1;if(!0===b&&!0===h)return!0}}}if(e){if("pipe"===b)return p;f=Promise.all(l);c.resolvePromises&&null!==b&&"all"!==b&&(f=f.then(function(a){var c,d=a.length;for(c=0;c<d;c++){var e=a[c];if("concat"===b&&e)n=n.concat(e);else if("merge"===
b)q(n,e,!0,!1);else{if("nonempty"===b&&e)return e;if("last"===b)n=e;else{if(!1===b&&!1===e)return!1;if(!0===b&&!0===e)return!0}}}return n}));return f}return n}},!0,!1);return e}();t.Observable=function(){var e=function(){this.events={}};q(e.prototype,{createEvent:function(a,b){a=a.toLowerCase();var c=this.events;c[a]||(c[a]=new x(a,b));return c[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,c,d){a=a.toLowerCase();var e=this.events;e[a]||(e[a]=new x(a));return e[a].on(b,
c,d)},once:function(a,b,c,d){d=d||{};d.limit=1;return this.on(a,b,c,d)},un:function(a,b,c){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(b,c)},relayEvent:function(a,b,c,d){a.on(b,this.trigger,this,{prepend:"*"===b?null:[c||b],replaceArgs:"*"===b&&d?function(a,b){b[0]=d+b[0];return b}:null})},unrelayEvent:function(a,b){a.un(b,this.trigger,this)},hasListener:function(a,b,c){var d=this.events;if(a)return a=a.toLowerCase(),d[a]?d[a].hasListener(b,c):!1;for(a in d)if(d[a].hasListener())return!0;return!1},
hasEvent:function(a){return!!this.events[a]},removeAllListeners:function(a){var b=this.events;if(a)b[a]&&b[a].removeAllListeners();else for(a in b)b[a].removeAllListeners()},trigger:function(){var a=arguments[0],b=this.events,c=null;a=a.toLowerCase();if(b[a]){var d=b[a];c=d.trigger.apply(d,u(arguments).slice(1))}(d=b["*"])&&d.trigger.apply(d,arguments);return c},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},
resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),b[a].$destroy(),delete b[a])},$destroy:function(){var a=this.events,b;for(b in a)this.destroyEvent(b);for(b in this)this[b]=null}},!0,!1);var c=function(a,b,c){for(var d in c)a.createEvent?a.createEvent(d,c[d]):b.createEvent(d,c[d])};e.$initHost=function(a,b,e){var d;a.$$events&&
c(a,e,a.$$events);if(b&&b.callback){var f=b.callback,m=f.context||f.scope||f.$context;f.$events&&c(a,e,f.$events);f.context=null;f.scope=null;for(d in f)if(f[d]){var l=a,k=e,p=d,n=f[d],g=m;l.on?l.on(p,n,g||l):k.on(p,n,g||l)}b.callback=null;m&&(a.$$callbackContext=m)}};e.$initHostConfig=function(a,b,c,d){var e=t.Config.MODE_LISTENER,f;b.setDefaultMode("callbackContext",t.Config.MODE_SINGLE);b.eachProperty(function(l){"on--"===l.substring(0,4)&&(b.setMode(l,e),f||(f=c.$app?b.get("callbackContext")||
(d?c.$app.getParentCmp(d):null)||c.$app||c:b.get("callbackContext")||c),a.on(l.substring(4),b.get(l),f))})};return e}();return t.Observable});
