(function(){function u(c){if(c&&void 0!=!c.length&&c!==""+c){for(var a=[],b=-1,d=c.length>>>0;++b!==d;a[b]=c[b]);return a}return c?[c]:[]}function q(c){return"object"==typeof c&&3===y(c)&&!c.nodeType&&c.constructor===Object}function w(c){return!0===c||!1===c}function n(){var c=!1,a=!1,b=u(arguments),d=b.shift(),e,f,h;w(b[b.length-1])&&(c=b.pop());w(b[b.length-1])&&(a=c,c=b.pop());for(;e=b.shift();)for(f in e)if(e.hasOwnProperty(f)&&void 0!==(h=e[f]))if(a)if(d[f]&&q(d[f])&&q(h))n(d[f],h,c,a);else{if(!0===
c||void 0==d[f])q(h)?(d[f]={},n(d[f],h,c,!0)):d[f]=h}else if(!0===c||void 0==d[f])d[f]=h;return d}function z(c,a,b,d){return setTimeout(function(){c.apply(a,b||[])},d||0)}var A=Object.prototype.toString,y=function(){var c={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(a){if(!a){if(null===a)return 6;if(void 0===a)return 7}var b=c[A.call(a)];return void 0===b?-1:1===b&&
isNaN(a)?8:b}}(),B=function(){var c=["0","0","0"];return function(){for(var a=c.length,b;a;){a--;b=c[a].charCodeAt(0);if(57==b)return c[a]="A",c.join("");if(90==b)c[a]="0";else return c[a]=String.fromCharCode(b+1),c.join("")}c.unshift("0");return c.join("")}}(),C=function(){var c=[],a=function(a){var b;var e=0;for(b=c.length;e<b;e++)c[e][0].call(c[e][1],a);"undefined"!=typeof console&&console.error&&console.error(a)};a.on=function(b,d){a.un(b,d);c.push([b,d])};a.un=function(a,d){var b;var f=0;for(b=
c.length;f<b;f++)if(c[f][0]===a&&c[f][1]===d){c.splice(f,1);break}};return a}(),x=function(){var c=function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=B();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;"object"===typeof b&&null!==b?n(this,b,!0,!1):this.returnResult=b};n(c.prototype,{name:null,listeners:null,map:null,hash:null,uni:null,suspended:!1,lid:null,returnResult:null,autoTrigger:null,lastTrigger:null,triggerFilter:null,filterContext:null,expectPromises:!1,resolvePromises:!1,
getName:function(){return this.name},$destroy:function(){for(var a in this)this[a]=null},on:function(a,b,d){if(!a)return null;b=b||null;d=d||{};var e=this.uni,c=a[e]||++this.lid,h=e+"_"+c,r=d.first||!1;if(a[e]&&(!b||b[h])&&!d.allowDupes)return null;a[e]||(a[e]=c);b&&!b[h]&&(b[h]=!0);a={fn:a,context:b,id:c,async:!1,called:0,limit:0,start:1,count:0,append:null,prepend:null};n(a,d,!0,!1);!0===a.async&&(a.async=1);r?this.listeners.unshift(a):this.listeners.push(a);this.map[c]=a;if(this.autoTrigger&&this.lastTrigger&&
!this.suspended){var l=this.triggerFilter;this.triggerFilter=function(a){return a.id===c?l?!1!==l(a):!0:!1};this.trigger.apply(this,this.lastTrigger);this.triggerFilter=l}return c},once:function(a,b,d){d=d||{};d.limit=1;return this.on(a,b,d)},un:function(a,b){var d=-1,c=this.uni,f=this.listeners;var h=a==parseInt(a)?parseInt(a):a[c];if(!h)return!1;var n=c+"_"+h;b=b||null;for(var l=0,p=f.length;l<p;l++)if(f[l].id===h&&f[l].context===b){d=l;delete a[c];b&&delete b[n];break}if(-1===d)return!1;f.splice(d,
1);delete this.map[h];return!0},hasListener:function(a,b){var d=this.listeners;if(a){a="function"!=typeof a?parseInt(a):a[this.uni];if(!a)return!1;for(var c=this.uni+"_"+a,f=0,h=d.length;f<h;f++)if(d[f].id===a&&(!b||b[c]))return!0;return!1}return 0<d.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,d;var c=0;for(d=a.length;c<d;c++){var f=b+"_"+a[c].fn[b];delete a[c].fn[b];a[c].context&&delete a[c].context[f]}this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},
resume:function(){this.suspended=!1},_prepareArgs:function(a,b){if(a.append||a.prepend)b=b.slice(),a.prepend&&(b=a.prepend.concat(b)),a.append&&(b=b.concat(a.append));return b},trigger:function(){var a=this,b=a.listeners,d=a.returnResult,c=a.triggerFilter,f=a.filterContext,h=a.expectPromises,r=a.keepPromiseOrder,l=[],p=u(arguments),t;if(a.suspended)return null;a.autoTrigger&&(a.lastTrigger=p.slice());if(0===b.length)return null;var m="all"===d||"concat"===d?[]:"merge"===d?{}:null,g;var q="first"===
d?[b[0]]:b.slice();for(h&&"last"===d&&(r=!0);g=q.shift();)if(!(!g||!a.map[g.id]||(b=a._prepareArgs(g,p),c&&!1===c.call(f,g,b,a))||g.filter&&!1===g.filter.apply(g.filterContext||g.context,b)||(g.count++,g.count<g.start))){if(g.async&&!h){var k=null;z(g.fn,g.context,b,g.async)}else h?(k=function(b,d,c){return function(e){"pipe"===d&&(c[0]=e,c=a._prepareArgs(b,c));return b.fn.apply(b.context,c)}}(g,d,p.slice()),k=t?t.then(k):g.fn.apply(g.context,b),k.catch(C)):k=g.fn.apply(g.context,b);g.called++;g.called===
g.limit&&a.un(g.id);if("first"===d)return k;if(h)l.push(k),("pipe"===d||r)&&k&&(t=k);else if(null!==d)if("all"===d)m.push(k);else if("concat"===d&&k)m=m.concat(k);else if("merge"===d)n(m,k,!0,!1);else{if("nonempty"===d&&k)return k;if("pipe"===d)m=k,p[0]=k;else if("last"===d)m=k;else{if(!1===d&&!1===k)return!1;if(!0===d&&!0===k)return!0}}}if(h){if("pipe"===d)return t;c=Promise.all(l);a.resolvePromises&&null!==d&&"all"!==d&&(c=c.then(function(a){var b,c=a.length;for(b=0;b<c;b++){var e=a[b];if("concat"===
d&&e)m=m.concat(e);else if("merge"===d)n(m,e,!0,!1);else{if("nonempty"===d&&e)return e;if("last"===d)m=e;else{if(!1===d&&!1===e)return!1;if(!0===d&&!0===e)return!0}}}return m}));return c}return m}},!0,!1);return c}(),D=function(){var c=function(){this.events={}};n(c.prototype,{createEvent:function(a,b){a=a.toLowerCase();var d=this.events;d[a]||(d[a]=new x(a,b));return d[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,d,c){a=a.toLowerCase();var e=this.events;e[a]||
(e[a]=new x(a));return e[a].on(b,d,c)},once:function(a,b,c,e){e=e||{};e.limit=1;return this.on(a,b,c,e)},un:function(a,b,c){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(b,c)},relayEvent:function(a,b){a.on(b,this.trigger,this,{prepend:"*"===b?null:[b]})},unrelayEvent:function(a,b){a.un(b,this.trigger,this)},hasListener:function(a,b,c){var d=this.events;if(a)return a=a.toLowerCase(),d[a]?d[a].hasListener(b,c):!1;for(a in d)if(d[a].hasListener())return!0;return!1},hasEvent:function(a){return!!this.events[a]},
removeAllListeners:function(a){var b=this.events;if(a)b[a]&&b[a].removeAllListeners();else for(a in b)b[a].removeAllListeners()},trigger:function(){var a=arguments[0],b=this.events,c=null;a=a.toLowerCase();if(b[a]){var e=b[a];c=e.trigger.apply(e,u(arguments).slice(1))}(e=b["*"])&&e.trigger.apply(e,arguments);return c},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=
a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),b[a].$destroy(),delete b[a])},$destroy:function(){var a=this.events,b;for(b in a)this.destroyEvent(b);for(b in this)this[b]=null},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent relayEvent unrelayEvent".split(" "),
b={},c,e=-1,f=a.length;++e<f;c=a[e],b[c]=this[c].bind(this));this.api=b}return this.api}},!0,!1);return c}(),v={};v.Observable=D;"undefined"!=typeof global?global.MetaphorJs=v:window.MetaphorJs=v})();
