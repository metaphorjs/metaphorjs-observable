(function(){function r(a){return"object"==typeof a&&3===x(a)&&!a.nodeType&&a.constructor===Object}function v(a){return!0===a||!1===a}function y(a,b,c,d){return setTimeout(function(){a.apply(b,c||[])},d||0)}var z=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){return a.apply(b,arguments)}},p=Array.prototype.slice,A=Object.prototype.toString,x=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,
"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var c=a[A.call(b)];return void 0===c?-1:1===c&&isNaN(b)?8:c}}(),q=function(){return function b(){var c=!1,d=!1,e=p.call(arguments),f=e.shift(),m,g,l;v(e[e.length-1])&&(c=e.pop());v(e[e.length-1])&&(d=c,c=e.pop());for(;e.length;)if((m=e.shift())&&m.hasOwnProperty)for(g in m)if(m.hasOwnProperty(g)&&void 0!==(l=m[g]))if(d)if(f[g]&&r(f[g])&&r(l))b(f[g],l,c,d);else{if(!0===c||
void 0==f[g])r(l)?(f[g]={},b(f[g],l,c,!0)):f[g]=l}else if(!0===c||void 0==f[g])f[g]=l;return f}}(),B=function(){var a=["0","0","0"];return function(){for(var b=a.length,c;b;){b--;c=a[b].charCodeAt(0);if(57==c)return a[b]="A",a.join("");if(90==c)a[b]="0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}(),t=function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=B();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;"object"===typeof b&&null!==
b?q(this,b,!0,!1):this.returnResult=b};q(t.prototype,{name:null,listeners:null,map:null,hash:null,uni:null,suspended:!1,lid:null,returnResult:null,autoTrigger:null,lastTrigger:null,triggerFilter:null,filterContext:null,expectPromises:!1,resolvePromises:!1,getName:function(){return this.name},$destroy:function(){for(var a in this)this[a]=null},on:function(a,b,c){if(!a)return null;b=b||null;c=c||{};var d=this.uni,e=a[d]||++this.lid,f=d+"_"+e,m=c.first||!1;if(a[d]&&(!b||b[f])&&!c.allowDupes)return null;
a[d]||(a[d]=e);b&&!b[f]&&(b[f]=!0);a={fn:a,context:b,id:e,async:!1,called:0,limit:0,start:1,count:0,append:null,prepend:null};q(a,c,!0,!1);!0===a.async&&(a.async=1);m?this.listeners.unshift(a):this.listeners.push(a);this.map[e]=a;if(this.autoTrigger&&this.lastTrigger&&!this.suspended){var g=this.triggerFilter;this.triggerFilter=function(a){return a.id===e?g?!1!==g(a):!0:!1};this.trigger.apply(this,this.lastTrigger);this.triggerFilter=g}return e},once:function(a,b,c){c=c||{};c.limit=1;return this.on(a,
b,c)},un:function(a,b){var c=-1,d=this.uni,e=this.listeners;var f=a==parseInt(a)?parseInt(a):a[d];if(!f)return!1;var m=d+"_"+f;b=b||null;for(var g=0,l=e.length;g<l;g++)if(e[g].id===f&&e[g].context===b){c=g;delete a[d];b&&delete b[m];break}if(-1===c)return!1;e.splice(c,1);delete this.map[f];return!0},hasListener:function(a,b){var c=this.listeners;if(a){a="function"!=typeof a?parseInt(a):a[this.uni];if(!a)return!1;for(var d=this.uni+"_"+a,e=0,f=c.length;e<f;e++)if(c[e].id===a&&(!b||b[d]))return!0;return!1}return 0<
c.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,c;var d=0;for(c=a.length;d<c;d++){var e=b+"_"+a[d].fn[b];delete a[d].fn[b];a[d].context&&delete a[d].context[e]}this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){if(a.append||a.prepend)b=p.call(b),a.prepend&&(b=a.prepend.concat(b)),a.append&&(b=b.concat(a.append));return b},trigger:function(){var a=this,b=a.listeners,c=a.returnResult,d=a.triggerFilter,
e=a.filterContext,f=a.expectPromises,m=a.keepPromiseOrder,g=[],l;if(a.suspended)return null;a.autoTrigger&&(a.lastTrigger=p.call(arguments));if(0===b.length)return null;var n="all"===c||"concat"===c?[]:"merge"===c?{}:null,h;var r="first"===c?[b[0]]:p.call(b);for(f&&"last"===c&&(m=!0);h=r.shift();)if(!(!h||!a.map[h.id]||(b=a._prepareArgs(h,arguments),d&&!1===d.call(e,h,b,a))||h.filter&&!1===h.filter.apply(h.filterContext||h.context,b)||(h.count++,h.count<h.start))){if(h.async&&!f){var k=null;y(h.fn,
h.context,b,h.async)}else f?(k=function(b,c,d){return function(e){"pipe"===c&&(d[0]=e,d=a._prepareArgs(b,d));return b.fn.apply(b.context,d)}}(h,c,p.call(arguments)),k=l?l.then(k):h.fn.apply(h.context,b),k.catch(function(a){console.log(a)})):k=h.fn.apply(h.context,b);h.called++;h.called===h.limit&&a.un(h.id);if("first"===c)return k;if(f)g.push(k),("pipe"===c||m)&&k&&(l=k);else if(null!==c)if("all"===c)n.push(k);else if("concat"===c&&k)n=n.concat(k);else if("merge"===c)q(n,k,!0,!1);else{if("nonempty"===
c&&k)return k;if("pipe"===c)n=k,arguments[0]=k;else if("last"===c)n=k;else{if(!1===c&&!1===k)return!1;if(!0===c&&!0===k)return!0}}}if(f){if("pipe"===c)return l;d=Promise.all(g);a.resolvePromises&&null!==c&&"all"!==c&&(d=d.then(function(a){var b,d=a.length;for(b=0;b<d;b++){var e=a[b];if("concat"===c&&e)n=n.concat(e);else if("merge"===c)q(n,e,!0,!1);else{if("nonempty"===c&&e)return e;if("last"===c)n=e;else{if(!1===c&&!1===e)return!1;if(!0===c&&!0===e)return!0}}}return n}));return d}return n}},!0,!1);
var w=function(){this.events={}};q(w.prototype,{createEvent:function(a,b){a=a.toLowerCase();var c=this.events;c[a]||(c[a]=new t(a,b));return c[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,c,d){a=a.toLowerCase();var e=this.events;e[a]||(e[a]=new t(a));return e[a].on(b,c,d)},once:function(a,b,c,d){d=d||{};d.limit=1;return this.on(a,b,c,d)},un:function(a,b,c){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(b,c)},relayEvent:function(a,b){a.on(b,this.trigger,this,
{prepend:"*"===b?null:[b]})},unrelayEvent:function(a,b){a.un(b,this.trigger,this)},hasListener:function(a,b,c){var d=this.events;if(a)return a=a.toLowerCase(),d[a]?d[a].hasListener(b,c):!1;for(a in d)if(d[a].hasListener())return!0;return!1},hasEvent:function(a){return!!this.events[a]},removeAllListeners:function(a){var b=this.events;if(a)b[a]&&b[a].removeAllListeners();else for(a in b)b[a].removeAllListeners()},trigger:function(){var a=arguments[0],b=this.events,c=null;a=a.toLowerCase();if(b[a]){var d=
b[a];c=d.trigger.apply(d,p.call(arguments,1))}(d=b["*"])&&d.trigger.apply(d,arguments);return c},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),b[a].$destroy(),
delete b[a])},$destroy:function(){var a=this.events,b;for(b in a)this.destroyEvent(b);for(b in this)this[b]=null},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent relayEvent unrelayEvent".split(" "),b={},c,d=-1,e=a.length;++d<e;c=a[d],b[c]=z(this[c],this));this.api=b}return this.api}},!0,!1);var u={};u.Observable=w;"undefined"!=typeof global?global.MetaphorJs=u:window.MetaphorJs=
u})();
